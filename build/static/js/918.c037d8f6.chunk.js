"use strict";(self.webpackChunkgasomax_client=self.webpackChunkgasomax_client||[]).push([[918],{1232:(e,a,s)=>{s.d(a,{Az:()=>c,Fr:()=>u,J9:()=>o,P0:()=>n,dm:()=>l,i1:()=>d});var t=s(5294),r=s(591),i=s(6647);const o=(e,a,s)=>async o=>{try{const c=await t.Z.get("".concat(i.Z.instance.baseURL,"/api/provider?").concat(a,"=").concat(s,"&page=").concat(e),{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});o({type:r.E3,payload:{...c.data,filters:{filter:a,value:s}}})}catch(c){o({type:r.Q_,payload:{msg:c.response.statusText,status:c.response.status}})}},c=(e,a)=>async s=>{try{const o=await t.Z.post("".concat(i.Z.instance.baseURL,"/api/provider"),e,{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:r.Tm,payload:o.data.data}),a(o.data)}catch(o){s({type:r.Q_,payload:{msg:o.response.statusText,status:o.response.status}}),a({success:!1,message:o.message})}},n=(e,a,s)=>async o=>{try{const c=await t.Z.put("".concat(i.Z.instance.baseURL,"/api/provider/").concat(a),e,{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});o({type:r.rE,payload:c.data.data}),s(c.data)}catch(c){o({type:r.Q_,payload:{msg:c.response.statusText,status:c.response.status}}),s({success:!1,message:c.message})}},l=(e,a)=>async s=>{try{const o=await t.Z.delete("".concat(i.Z.instance.baseURL,"/api/provider/").concat(e),{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:r.Z4,payload:e}),a(o.data)}catch(o){s({type:r.Q_,payload:{msg:o.response.statusText,status:o.response.status}}),a({success:!1,message:o.message})}},d=(e,a)=>async s=>{try{const o=await t.Z.get("".concat(i.Z.instance.baseURL,"/api/excel/provider/export?").concat(e,"=").concat(a),{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")},responseType:"blob"}),c=window.URL.createObjectURL(new Blob([o.data])),n=document.createElement("a");n.href=c,n.setAttribute("download","Proveedores.xlsx"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(c),s({type:r.Nx})}catch(o){s({type:r.Q_,payload:{msg:o.response.statusText,status:o.response.status}})}},u=()=>async e=>{try{const a=await t.Z.get("".concat(i.Z.instance.baseURL,"/api/select/provider"),{headers:{...i.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});e({type:r.tb,payload:a.data})}catch(a){e({type:r.Q_,payload:{msg:a.response.statusText,status:a.response.status}})}}},7462:(e,a,s)=>{s.d(a,{O:()=>t});const t={csf:"CSF"}},7201:(e,a,s)=>{s.d(a,{Tg:()=>p,a4:()=>l,iT:()=>o,mY:()=>c,mk:()=>u,uD:()=>d,uf:()=>i,yw:()=>n});var t=s(9779),r=s(9101);const i=e=>(e/1).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),o=e=>t.ou.fromISO(e).toLocaleString(t.ou.DATE_SHORT),c=e=>t.ou.fromISO(e).toLocaleString(t.ou.DATETIME_SHORT),n={advance:"Anticipo",settlement:"Liquidaci\xf3n",payment:"Abono a cuenta"},l={pending:"Cotizaci\xf3n completa",approved:"Cotizaci\xf3n aprobada",paid:"Cotizaci\xf3n pagada",rejected:"Cotizaci\xf3n rechazada"},d={pending:"warning",approved:"success",paid:"info",rejected:"danger"},u={index:"Lectura",create:"Crear",edit:"Editar",delete:"Eliminar",reject:"Rechazar",pay:"Pagar",authorize:"Autorizar",modules:"Asignar modulos",permissions:"Asignar permisos"},p=(e,a)=>{const s=(0,r.v9)((e=>e.auth.permissions)),t=(0,r.v9)((e=>e.auth.modules)).find((a=>a.submodule===e));return!!t&&!!s.find((e=>e.submodule===t.submodule&&e.permission===a))}},1732:(e,a,s)=>{s.d(a,{K:()=>t});const t={provider:"provider"}},1918:(e,a,s)=>{s.r(a),s.d(a,{default:()=>L});var t=s(2791),r=s(2937),i=s(4846),o=s(8030),c=s(8723),n=s(3896),l=s(9101),d=s(1830),u=s.n(d),p=(s(7462),s(9463)),h=s(1732),m=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M296,240H216a46.222,46.222,0,1,1,0-92.444H344v-32H276V56H244v59.556H216A78.222,78.222,0,0,0,216,272h80a46.274,46.274,0,0,1,46.222,46.222v3.556A46.274,46.274,0,0,1,296,368H160.593v32H244v56h32V400h20a78.31,78.31,0,0,0,78.222-78.222v-3.556A78.31,78.31,0,0,0,296,240Z' class='ci-primary'/>"],x=s(7256),v=s(574),g=s(7201),j=s(1232),b=s(5294),y=s(591),f=s(6647);const N=(e,a,s)=>async t=>{try{const r=await b.Z.get("".concat(f.Z.instance.baseURL,"/api/purchaseRequest?").concat(a,"=").concat(s,"&page=").concat(e),{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:y.Cj,payload:{...r.data,filters:{filter:a,value:s}}})}catch(r){t({type:y.MH,payload:{msg:r.response.statusText,status:r.response.status}})}};var C=s(4166),S=["512 512","<rect width='368' height='32' x='72' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],R=s(184);const A=e=>{let{onAddDetailPending:a,onRemoveDetailPending:s,detailPendingID:c,details:n}=e;const{pendingPayments:d}=(0,l.v9)((e=>e.purchaseRequest)),[u,p]=(0,t.useState)([]);return(0,t.useEffect)((()=>{p(d.filter((e=>!n.find((a=>a.purchase_detail_pending_id===e.id)))))}),[n,d]),(0,R.jsxs)(r.Sx,{striped:!0,responsive:!0,children:[(0,R.jsx)(r.V,{children:(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.is,{scope:"col",children:"Opciones"}),(0,R.jsx)(r.is,{scope:"col",children:"Cargo"}),(0,R.jsx)(r.is,{scope:"col",children:"Concepto"}),(0,R.jsx)(r.is,{scope:"col",children:"Obs."}),(0,R.jsx)(r.is,{scope:"col",children:"Saldo pendiente"})]})}),(0,R.jsx)(r.NR,{children:u.map(((e,t)=>(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.NN,{children:c!==e.id?(0,R.jsx)(r.u5,{color:"primary",variant:"outline",title:"Agregar",onClick:()=>a(e),children:(0,R.jsx)(i.Z,{icon:o.q,size:"sm"})}):(0,R.jsx)(r.u5,{color:"danger",variant:"outline",title:"Quitar",onClick:()=>s(),children:(0,R.jsx)(i.Z,{icon:S,size:"sm"})})}),(0,R.jsx)(r.NN,{children:e.charge}),(0,R.jsx)(r.NN,{children:e.concept}),(0,R.jsx)(r.NN,{children:e.observation}),(0,R.jsx)(r.NN,{children:(0,g.uf)(e.balance)})]},e.id)))})]})},w=e=>{let{visible:a,onClose:s,purchaseData:c,view:n}=e;const[d,p]=(0,t.useState)(1),[h,N]=(0,t.useState)(""),[S,w]=(0,t.useState)(null),[T,Z]=(0,t.useState)(!1),[L,k]=(0,t.useState)("guerra"),[I,z]=(0,t.useState)("gasStation"),[E,O]=(0,t.useState)(""),[q,B]=(0,t.useState)("cash"),[F,_]=(0,t.useState)(!1),[H,M]=(0,t.useState)([]),[D,P]=(0,t.useState)(""),[U,K]=(0,t.useState)(""),[V,Q]=(0,t.useState)("advance"),[X,$]=(0,t.useState)(""),[G,Y]=(0,t.useState)(0),[J,W]=(0,t.useState)(0),[ee,ae]=(0,t.useState)(!1),[se,te]=(0,t.useState)("quotation"),[re,ie]=(0,t.useState)([]),oe=(0,l.I0)(),{progress:ce}=(0,l.v9)((e=>e.file)),{loading:ne,providers:le}=(0,l.v9)((e=>e.provider)),{pendingPayments:de}=(0,l.v9)((e=>e.purchaseRequest)),ue=(0,g.Tg)("purchaseRequest","pay"),pe=(0,g.Tg)("purchaseRequest","reject"),he=(0,g.Tg)("purchaseRequest","authorize");(0,t.useEffect)((()=>{oe((0,j.Fr)())}),[oe]),(0,t.useEffect)((()=>{var e;E&&""!==E&&(oe((e=E,async a=>{try{const s=await b.Z.get("".concat(f.Z.instance.baseURL,"/api/pending/details/purchaseRequest?provider_id=").concat(e),{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});a({type:y.lL,payload:s.data})}catch(s){a({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}})}})),ae(!1),c||M([]))}),[oe,E,c]),(0,t.useEffect)((()=>{c&&(N(c.id),Z(c.extraordinary),k(c.station),z(c.business),O(c.provider.id),B(c.paymentMethod),_(c.pettyCash),M(c.details))}),[c]),(0,t.useEffect)((()=>{_(!1)}),[q]),(0,t.useEffect)((()=>{"settlement"===V&&W(G)}),[V,G]);const me=()=>{P(""),K(""),Q("advance"),$(""),Y(0),W(0),w(null)};return(0,R.jsxs)(r.Tk,{visible:a,onClose:s,"aria-labelledby":"ModalForm",size:"xl",children:[(0,R.jsx)(r.p0,{onClose:s,children:(0,R.jsx)(r.fl,{id:"ModalForm",children:c?"Editar solicitud":"Nueva solicitud"})}),(0,R.jsxs)(r.sD,{children:[re.length>0&&(0,R.jsxs)(r.yI,{value:ce,className:"mb-2",children:[ce,"%"]}),(0,R.jsxs)(r.n2,{variant:"tabs",role:"tablist",className:"mt-1",children:[(0,R.jsx)(r.U6,{role:"presentation",children:(0,R.jsx)(r.AQ,{active:1===d,component:"button",role:"tab","aria-controls":"data-tab-pane","aria-selected":1===d,onClick:()=>p(1),children:"General"})}),(0,R.jsx)(r.U6,{role:"presentation",children:(0,R.jsx)(r.AQ,{active:2===d,component:"button",role:"tab","aria-controls":"account-tab-pane","aria-selected":2===d,onClick:()=>p(2),children:"Detalles"})}),(0,R.jsx)(r.U6,{role:"presentation",children:(0,R.jsx)(r.AQ,{active:3===d,component:"button",role:"tab","aria-controls":"account-tab-pane","aria-selected":3===d,onClick:()=>p(3),children:"Archivos"})})]}),(0,R.jsxs)(r.gr,{children:[(0,R.jsx)(r.IA,{role:"tabpanel","aria-labelledby":"data-tab-pane",visible:1===d,children:(0,R.jsxs)(r.lx,{className:"mt-3",children:[(0,R.jsx)("div",{className:"mb-3",children:(0,R.jsx)(r.EC,{id:"extraordinary",label:"Solicitud extraordinaria",checked:T,onChange:e=>Z(e.target.checked)})}),(0,R.jsxs)("div",{className:"mb-3 d-flex",children:[(0,R.jsxs)("div",{className:"flex-fill me-2",children:[(0,R.jsx)(r.L8,{children:"Estaci\xf3n solicitante"}),(0,R.jsx)(r.LX,{"aria-label":"station",options:[{label:"Guerra",value:"guerra"},{label:"Servicio el milagro",value:"milagro"},{label:"Estadio",value:"estadio"}],onChange:e=>k(e.target.value),value:L})]}),(0,R.jsxs)("div",{className:"flex-fill",children:[(0,R.jsx)(r.L8,{children:"Negocio"}),(0,R.jsx)(r.LX,{"aria-label":"business",options:[{label:"Gasolinera",value:"gasStation"},{label:"Max store",value:"store"},{label:"Restaurante",value:"restaurant"},{label:"Pension",value:"pension"}],onChange:e=>z(e.target.value),value:I})]})]}),(0,R.jsxs)("div",{className:"mb-3",children:[(0,R.jsx)(r.L8,{children:"Proveedor (*)"}),(0,R.jsxs)(r.LX,{"aria-label":"provider",onChange:e=>O(e.target.value),value:E,disabled:n||c,children:[(0,R.jsx)("option",{children:"Seleccione..."}),le.data.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)("div",{className:"mb-3",children:[(0,R.jsx)(r.L8,{children:"Forma de pago"}),(0,R.jsx)(r.LX,{"aria-label":"paymentMethod",options:[{label:"Transferencia",value:"transference"},{label:"Cheque",value:"check"},{label:"Efectivo",value:"cash"}],onChange:e=>B(e.target.value),value:q})]}),"cash"===q&&(0,R.jsx)("div",{className:"mb-3",children:(0,R.jsx)(r.EC,{id:"PCash",label:"Caja chica",onChange:e=>_(e.target.checked),checked:F})})]})}),(0,R.jsx)(r.IA,{role:"tabpanel","aria-labelledby":"account-tab-pane",visible:2===d,children:(0,R.jsxs)(r.lx,{className:"mt-3",children:[ee?(0,R.jsx)(A,{onAddDetailPending:e=>(e=>{P(e.charge),K(e.concept),$(e.observation),Q("settlement"),Y(e.balance),w(e.id),ae(!1)})(e),onRemoveDetailPending:()=>(me(),void ae(!1)),detailPendingID:S,details:H}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"mb-3 d-flex",children:[(0,R.jsxs)("div",{className:"flex-fill me-2",children:[(0,R.jsx)(r.L8,{children:"Cargo"}),(0,R.jsx)(r.LX,{"aria-label":"charge",options:[{label:"Seleccione...",value:""},{label:"ACTIVO FIJO",value:"ACTIVO FIJO"},{label:"GASTOS DIRECTOS DE OPERACI\xd3N",value:"GASTOS DIRECTOS DE OPERACI\xd3N"}],onChange:e=>P(e.target.value),value:D,disabled:S})]}),(0,R.jsxs)("div",{className:"flex-fill me-2",children:[(0,R.jsx)(r.L8,{children:"Concepto"}),(0,R.jsx)(r.LX,{"aria-label":"concept",options:[{label:"Seleccione...",value:""},{label:"Equipo y software inform\xe1tico",value:"Equipo y software inform\xe1tico"},{label:"Veh\xedculos",value:"Veh\xedculos"},{label:"Honorarios",value:"Honorarios"}],onChange:e=>K(e.target.value),value:U,disabled:S})]}),(0,R.jsxs)("div",{className:"flex-fill",children:[(0,R.jsx)(r.L8,{children:"Tipo de movimiento"}),(0,R.jsxs)(r.LX,{"aria-label":"movementType",onChange:e=>Q(e.target.value),value:V,children:[!S&&(0,R.jsx)("option",{value:"advance",children:"Anticipo"}),(0,R.jsx)("option",{value:"settlement",children:"Liquidaci\xf3n"}),S&&(0,R.jsx)("option",{value:"payment",children:"Abono a cuenta"})]})]})]}),(0,R.jsx)("div",{className:"mb-3",children:(0,R.jsx)(r.PB,{id:"obs",label:"Observaci\xf3n",rows:2,text:"Debe tener entre 5 y 10 palabras.",value:X,onChange:e=>$(e.target.value)})}),(0,R.jsxs)("div",{className:"mb-3 d-flex",children:[(0,R.jsxs)("div",{className:"flex-fill me-2",children:[(0,R.jsx)(r.L8,{htmlFor:"totalAmount",children:"Importe total ($)"}),(0,R.jsx)(r.jO,{type:"number",id:"totalAmount",placeholder:"Importe",onChange:e=>Y(e.target.value),value:G,disabled:S})]}),(0,R.jsxs)("div",{className:"flex-fill",children:[(0,R.jsx)(r.L8,{htmlFor:"paymentAmount",children:"Importe a pagar ($)"}),(0,R.jsx)(r.jO,{type:"number",id:"paymentAmount",placeholder:"Pago",onChange:e=>W(e.target.value),value:J,disabled:"settlement"===V})]})]})]}),(0,R.jsxs)("div",{className:"mb-3",children:[!ee&&(0,R.jsxs)(r.u5,{color:"primary",className:"text-light fw-semibold me-2",onClick:()=>{if(""===D)return void oe((0,C.f)((0,v.Kv)({msg:"Selecciona un cargo",type:"error"})));if(""===U)return;const e={charge:D,concept:U,movementType:V,observation:X,totalAmount:G,paymentAmount:J,purchase_detail_pending_id:S};M([...H,e]),me()},children:[(0,R.jsx)(i.Z,{icon:o.q,className:"me-1"}),"A\xf1adir a la solicitud"]}),de.length>0&&E&&(0,R.jsxs)(r.u5,{color:ee?"danger":"info",className:"text-light fw-semibold",onClick:()=>ae(!ee),children:[(0,R.jsx)(i.Z,{icon:m,className:"me-1"}),ee?"Ocultar":"Ver"," pagos pendientes"]})]}),(0,R.jsxs)(r.Sx,{striped:!0,responsive:!0,children:[(0,R.jsx)(r.V,{children:(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.is,{scope:"col",children:"Cargo"}),(0,R.jsx)(r.is,{scope:"col",children:"Concepto"}),(0,R.jsx)(r.is,{scope:"col",children:"Tipo Mov."}),(0,R.jsx)(r.is,{scope:"col",children:"Obs."}),(0,R.jsx)(r.is,{scope:"col",children:"Importe total"}),(0,R.jsx)(r.is,{scope:"col",children:"Pago"}),(0,R.jsx)(r.is,{scope:"col",children:"Saldo"}),(0,R.jsx)(r.is,{scope:"col",children:"Opciones"})]})}),(0,R.jsxs)(r.NR,{children:[H.map(((e,a)=>(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.NN,{children:e.charge}),(0,R.jsx)(r.NN,{children:e.concept}),(0,R.jsx)(r.NN,{children:g.yw[e.movementType]}),(0,R.jsx)(r.NN,{children:e.observation}),(0,R.jsx)(r.NN,{children:(0,g.uf)(e.totalAmount)}),(0,R.jsx)(r.NN,{children:(0,g.uf)(e.paymentAmount)}),(0,R.jsx)(r.NN,{children:(0,g.uf)(Math.round(e.totalAmount-e.paymentAmount))}),(0,R.jsx)(r.NN,{children:(0,R.jsx)(r.u5,{color:"danger",variant:"outline",title:"Eliminar",onClick:()=>{return e=a,void M(H.filter(((a,s)=>s!==e)));var e},children:(0,R.jsx)(i.Z,{icon:x.N,size:"sm"})})})]},e.concept))),H.length>0&&(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.NN,{colSpan:5}),(0,R.jsxs)(r.NN,{scope:"col",colSpan:3,children:["$",(0,g.uf)(H.reduce(((e,a)=>e+parseFloat(a.paymentAmount)),0))]})]})]})]})]})}),(0,R.jsx)(r.IA,{role:"tabpanel","aria-labelledby":"data-tab-pane",visible:3===d,children:(0,R.jsxs)(r.lx,{className:"mt-3",children:[(0,R.jsx)(r.L8,{children:"Sube archivos necesarios para la solicitud"}),(0,R.jsxs)("div",{className:"mb-3",children:[(0,R.jsxs)("div",{className:"mb-2",children:[(0,R.jsx)(r.L8,{children:"Tipo de archivo"}),(0,R.jsx)(r.LX,{"aria-label":"fileType",options:[{label:"Cotizaci\xf3n ",value:"quotation"},{label:"Factura",value:"invoice"},{label:"Otro",value:"other"}],onChange:e=>te(e.target.value),value:se})]}),(0,R.jsx)(r.jO,{type:"file",id:"csfFile",placeholder:"nombre",onChange:e=>ie(e.target.files),multiple:!0,text:"Archivos permitidos jpg, pdf, png, xlxs (10 MB)"})]})]})})]})]}),(0,R.jsxs)(r.Ym,{children:[(0,R.jsx)(r.u5,{color:"secondary",onClick:s,children:"Cerrar"}),(0,R.jsx)(r.u5,{color:"primary",className:"text-light fw-semibold",onClick:e=>{e.preventDefault();try{if(!E||""===E)return void oe((0,C.f)((0,v.Kv)({msg:"Falta seleccionar un proveedor",type:"error"})));if(H.length<=0)return void oe((0,C.f)((0,v.Kv)({msg:"Falta agregar detalles a la solicitud",type:"error"})));let e={extraordinary:T,station:L,business:I,paymentMethod:q,pettyCash:F,details:H,provider_id:E,petitioner_id:1};oe(c?((e,a,s)=>async t=>{try{const r=await b.Z.put("".concat(f.Z.instance.baseURL,"/api/purchaseRequest/").concat(a),e,{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:y.kX,payload:r.data.data}),s(r.data)}catch(r){t({type:y.MH,payload:{msg:r.response.statusText,status:r.response.status}}),s({success:!1,message:r.message})}})(e,h,(e=>{e.success?oe((0,C.f)((0,v.Kv)({msg:"Solicitud actualizada correctamente.",title:"Solicitudes de compra",type:"success"}))):oe((0,C.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de compra",type:"error"})))})):((e,a)=>async s=>{try{const t=await b.Z.post("".concat(f.Z.instance.baseURL,"/api/purchaseRequest"),e,{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.LB,payload:t.data.data}),a(t.data)}catch(t){s({type:y.MH,payload:{msg:t.response.statusText,status:t.response.status}}),a({success:!1,message:t.message})}})(e,(e=>{e.success?oe((0,C.f)((0,v.Kv)({msg:"Solicitud realizada correctamente.",title:"Solicitudes de compra",type:"success"}))):oe((0,C.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de compra",type:"error"})))})))}catch(a){console.log(a)}s(),N(""),Z(!1),k("guerra"),z("gasStation"),O(""),B("cash"),_(!1),M([]),ie([])},children:"Guardar"}),n&&(0,R.jsxs)(R.Fragment,{children:["approved"!==c.status&&he&&(0,R.jsx)(r.u5,{color:"success",className:"text-light fw-semibold",onClick:e=>{e.preventDefault();try{oe((a={user_id:1},t=h,r=e=>{e.success?oe((0,C.f)((0,v.Kv)({msg:"Cotizaci\xf3n autorizada",type:"success"}))):oe((0,C.f)((0,v.Kv)({msg:"Ha ocurrido un error.",type:"error"})))},async e=>{try{const s=await b.Z.put("".concat(f.Z.instance.baseURL,"/api/approve/purchaseRequest/").concat(t),a,{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});e({type:y.kX,payload:s.data.data}),r(s.data)}catch(s){e({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}}),r({success:!1,message:s.message})}}))}catch(i){console.log(i)}var a,t,r;s()},children:"Autorizar"}),"approved"===c.status&&ue&&(0,R.jsx)(r.u5,{color:"info",className:"text-light fw-semibold",children:"Pagar"}),pe&&(0,R.jsx)(r.u5,{color:"danger",className:"text-light fw-semibold",onClick:()=>{u().fire({title:"Escribe un motivo del rechazo",input:"textarea",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Enviar",confirmButtonColor:"#E94834",showLoaderOnConfirm:!0,preConfirm:async e=>{try{if(!e)return void u().showValidationMessage("\n            Escribe una observacion\n          ");oe((a={observation:e,user_id:1},s=c.id,t=e=>{e.success&&oe((0,C.f)((0,v.Kv)({msg:"Solicitud rechazada",type:"success"})))},async e=>{try{const r=await b.Z.put("".concat(f.Z.instance.baseURL,"/api/reject/purchaseRequest/").concat(s),a,{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});e({type:y.kX,payload:r.data.data}),t(r.data)}catch(r){e({type:y.MH,payload:{msg:r.response.statusText,status:r.response.status}}),t({success:!1,message:r.message})}}))}catch(r){u().showValidationMessage("\n            Request failed: ".concat(r,"\n          "))}var a,s,t},allowOutsideClick:()=>!u().isLoading()}).then((e=>{e.isConfirmed&&u().fire({title:"Solicitud rechazada correctamente"})}))},children:"Rechazar"})]})]})]})},T=e=>{let{visible:a,onClose:s,purchaseRequestID:i}=e;const o=(0,l.I0)(),[c,n]=(0,t.useState)(""),{observations:d,loadingObservations:u}=(0,l.v9)((e=>e.purchaseRequest));(0,t.useEffect)((()=>{var e;o((e=i,async a=>{try{const s=await b.Z.get("".concat(f.Z.instance.baseURL,"/api/purchaseRequestObservation?purchase_request_id=").concat(e),{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});a({type:y.oj,payload:s.data})}catch(s){a({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}})}}))}),[o,i]);return(0,R.jsxs)(r.Tk,{visible:a,onClose:s,"aria-labelledby":"ModalForm",children:[(0,R.jsx)(r.p0,{onClose:s,children:(0,R.jsx)(r.fl,{id:"ModalForm",children:"Observaciones"})}),(0,R.jsx)(r.sD,{children:u?(0,R.jsx)("div",{className:"d-flex justify-content-center",children:(0,R.jsx)(r.LQ,{color:"primary",variant:"grow"})}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(r.Sx,{striped:!0,responsive:!0,children:[(0,R.jsx)(r.V,{children:(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.is,{scope:"col",children:"Usuario"}),(0,R.jsx)(r.is,{scope:"col",children:"Observaci\xf3n"}),(0,R.jsx)(r.is,{scope:"col",children:"Fecha"})]})}),(0,R.jsx)(r.NR,{children:null===d||void 0===d?void 0:d.map((e=>(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.NN,{children:e.user.name}),(0,R.jsx)(r.NN,{children:e.message}),(0,R.jsx)(r.NN,{children:(0,g.mY)(e.created_at)})]},e.id)))})]}),(0,R.jsx)(r.lx,{className:"mt-3",children:(0,R.jsx)("div",{className:"mb-3",children:(0,R.jsx)(r.PB,{id:"obs",label:"Observaci\xf3n",rows:2,text:"Debe tener entre 8 y 20 palabras.",value:c,onChange:e=>n(e.target.value)})})})]})}),(0,R.jsxs)(r.Ym,{children:[(0,R.jsx)(r.u5,{color:"secondary",onClick:s,children:"Cerrar"}),(0,R.jsx)(r.u5,{color:"primary",className:"text-light fw-semibold",onClick:e=>{e.preventDefault();try{if(!c||""===c)return void o((0,C.f)((0,v.Kv)({msg:"Escribe un mensaje",title:"Error",type:"error"})));o(((e,a)=>async s=>{try{const t=await b.Z.post("".concat(f.Z.instance.baseURL,"/api/purchaseRequestObservation"),e,{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.L4,payload:t.data.data}),a(t.data)}catch(t){s({type:y.MH,payload:{msg:t.response.statusText,status:t.response.status}}),a({success:!1,message:t.message})}})({message:c,user_id:1,purchase_request_id:i},(e=>{e.success?o((0,C.f)((0,v.Kv)({msg:"Mensaje guardado con exito",title:"Observacion",type:"success"}))):o((0,C.f)((0,v.Kv)({msg:"Ha ocurrido un error",title:"Observacion",type:"error"})))})))}catch(a){console.log(a)}n("")},children:"Guardar"})]})]})},Z=e=>{let{data:a}=e;const[s,o]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1),[m,x]=(0,t.useState)(null),[j,N]=(0,t.useState)(!1),S=(0,l.I0)(),A=(0,g.Tg)("purchaseRequest","delete"),Z=(0,g.Tg)("purchaseRequest","edit"),L=e=>{u().fire({title:"\xbfEst\xe1 seguro?",text:"No podr\xe1s revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar."}).then((a=>{a.isConfirmed&&(S(((e,a)=>async s=>{try{const t=await b.Z.delete("".concat(f.Z.instance.baseURL,"/api/purchaseRequest/").concat(e),{headers:{...f.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.jx,payload:e}),a(t.data)}catch(t){s({type:y.MH,payload:{msg:t.response.statusText,status:t.response.status}}),a({success:!1,message:t.message})}})(e,(a=>{a.success?(S((0,C.f)((0,v.Kv)({msg:"Solicitud eliminada correctamente.",title:"Solicitudes de compra",type:"success"}))),S((0,p.MM)(e,h.K.provider))):S((0,C.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de compra",type:"error"})))}))),u().fire({title:"Eliminado!",text:"La solicitud ha sido eliminada.",icon:"success"}))}))};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(r.Sx,{striped:!0,responsive:!0,children:[(0,R.jsx)(r.V,{children:(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.is,{scope:"col",children:"Folio"}),(0,R.jsx)(r.is,{scope:"col",children:"Solicitante"}),(0,R.jsx)(r.is,{scope:"col",children:"Proveedor"}),(0,R.jsx)(r.is,{scope:"col",children:"Importe"}),(0,R.jsx)(r.is,{scope:"col",children:"Fecha"}),(0,R.jsx)(r.is,{scope:"col",children:"Status"}),(0,R.jsx)(r.is,{scope:"col",className:"text-center",children:"Opciones"})]})}),(0,R.jsx)(r.NR,{children:null===a||void 0===a?void 0:a.map((e=>(0,R.jsxs)(r.T6,{children:[(0,R.jsx)(r.is,{scope:"row",children:e.id}),(0,R.jsx)(r.NN,{children:e.petitioner.name}),(0,R.jsx)(r.NN,{children:e.provider.name}),(0,R.jsxs)(r.NN,{children:["$",(0,g.uf)(e.details.reduce(((e,a)=>e+parseFloat(a.paymentAmount)),0))]}),(0,R.jsx)(r.NN,{children:(0,g.iT)(e.created_at)}),(0,R.jsx)(r.NN,{children:(0,R.jsx)(r.C_,{color:g.uD[e.status],children:g.a4[e.status]})}),(0,R.jsx)(r.NN,{className:"text-center overflow-visible",children:(0,R.jsxs)(r.w5,{variant:"dropdown",children:[(0,R.jsx)(r.SQ,{href:"#",color:"light",children:(0,R.jsx)(i.Z,{icon:n.t,title:"Opciones",size:"lg"})}),(0,R.jsxs)(r.$H,{className:"position-fixed",children:[(0,R.jsx)(r.$f,{style:{cursor:"pointer"},onClick:()=>{x(e),N(!0),o(!s)},children:"Ver solicitud"}),Z&&(0,R.jsx)(r.$f,{style:{cursor:"pointer"},onClick:()=>{x(e),o(!s)},children:"Editar"}),A&&(0,R.jsx)(r.$f,{style:{cursor:"pointer"},onClick:()=>L(e.id),children:"Eliminar"}),(0,R.jsx)(r.$f,{style:{cursor:"pointer"},onClick:()=>{x(e),d(!c)},children:"Ver observaciones"}),(0,R.jsx)(r.$f,{style:{cursor:"pointer"},onClick:()=>{var a;S((a=e.id,async e=>{try{const e=await b.Z.get("".concat(f.Z.instance.baseURL,"/api/pdf/purchaseRequest/export/").concat(a),{headers:{...f.Z.instance.headersFormData,Authorization:"Bearer "+localStorage.getItem("token")},responseType:"blob"}),s=window.URL.createObjectURL(e.data);window.open(s,"_blank")}catch(s){e({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}})}}))},children:"Imprimir"})]})]})})]},e.id)))})]}),s&&(0,R.jsx)(w,{visible:s,onClose:()=>{o(!1),N(!1)},purchaseData:m,view:j}),c&&(0,R.jsx)(T,{purchaseRequestID:null===m||void 0===m?void 0:m.id,visible:c,onClose:()=>d(!1)})]})},L=()=>{const[e,a]=(0,t.useState)(!1),[s,n]=(0,t.useState)("provider"),[d,u]=(0,t.useState)(""),[p,h]=(0,t.useState)(1),m=(0,l.I0)(),{currentPage:x,last_page:j,data:b}=(0,l.v9)((e=>e.purchaseRequest.purchaseRequests)),y=(0,l.v9)((e=>e.purchaseRequest.loading));return(0,t.useEffect)((()=>{m(N(p,s,d))}),[p,m]),(0,t.useEffect)((()=>{x&&h(x)}),[x]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(r.xH,{children:[(0,R.jsxs)(r.bn,{className:"d-flex justify-content-between align-items-center",children:[(0,R.jsx)("h4",{children:"Listado de solicitudes"}),(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,g.Tg)("purchaseRequest","create")&&(0,R.jsxs)(r.u5,{color:"primary",className:"text-light fw-semibold align-content-center d-flex",onClick:()=>a(!e),children:[(0,R.jsx)(i.Z,{icon:o.q,size:"xl",className:"me-1"}),"Nuevo"]}),(0,R.jsx)(r.u5,{color:"info",className:"text-light align-content-center d-flex",children:(0,R.jsx)(i.Z,{icon:c.j,size:"xl"})})]})]}),(0,R.jsxs)(r.sl,{children:[(0,R.jsxs)(r.lx,{children:[(0,R.jsx)(r.L8,{children:"Filtros de busqueda"}),(0,R.jsxs)("div",{className:"mb-3 d-flex",children:[(0,R.jsx)("div",{className:"flex-fill me-2",children:(0,R.jsx)(r.LX,{value:s,onChange:e=>n(e.target.value),"aria-label":"caseFilter",options:[{label:"Proveedor",value:"provider"},{label:"Solicitante",value:"petitioner"},{label:"Status",value:"status"}]})}),(0,R.jsx)("div",{className:"flex-fill me-2",children:"status"!==s?(0,R.jsx)(r.jO,{value:d,onChange:e=>u(e.target.value),type:"text",id:"provider",placeholder:"Ingresar texto"}):(0,R.jsx)(r.LX,{value:d,onChange:e=>u(e.target.value),"aria-label":"caseFilter",options:[{label:"Pendientes",value:"pending"},{label:"Revisadas",value:"review"},{label:"Aprobadas",value:"approved"},{label:"Rechazadas",value:"rejects"}]})})]}),(0,R.jsx)(r.u5,{type:"button",className:"text-light fw-semibold",onClick:()=>m(N(p,s,d)),children:"Buscar"})]}),y?(0,R.jsx)("div",{className:"d-flex justify-content-center",children:(0,R.jsx)(r.LQ,{color:"primary",variant:"grow"})}):(0,R.jsx)(Z,{data:b})]}),(0,R.jsx)(r.Bt,{children:(0,R.jsx)(v.bD,{currentPage:p,lastPage:j,setCurrentPage:h})})]}),(0,R.jsx)(w,{visible:e,onClose:()=>a(!1)})]})}},8723:(e,a,s)=>{s.d(a,{j:()=>t});var t=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"]}}]);
//# sourceMappingURL=918.c037d8f6.chunk.js.map