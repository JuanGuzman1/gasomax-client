"use strict";(self.webpackChunkgasomax_client=self.webpackChunkgasomax_client||[]).push([[731],{1232:(e,a,t)=>{t.d(a,{Az:()=>n,Fr:()=>u,J9:()=>o,P0:()=>c,dm:()=>l,i1:()=>d,j7:()=>p});var s=t(5294),i=t(591),r=t(6647);const o=(e,a,t)=>async o=>{try{const n=await s.Z.get("".concat(r.Z.instance.baseURL,"/api/provider?").concat(a,"=").concat(t,"&page=").concat(e),{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});o({type:i.E3,payload:{...n.data,filters:{filter:a,value:t}}})}catch(n){o({type:i.Q_,payload:{msg:n.response.statusText,status:n.response.status}})}},n=(e,a)=>async t=>{try{const o=await s.Z.post("".concat(r.Z.instance.baseURL,"/api/provider"),e,{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:i.Tm,payload:o.data.data}),a(o.data)}catch(o){t({type:i.Q_,payload:{msg:o.response.statusText,status:o.response.status}}),a({success:!1,message:o.message})}},c=(e,a,t)=>async o=>{try{const n=await s.Z.put("".concat(r.Z.instance.baseURL,"/api/provider/").concat(a),e,{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});o({type:i.rE,payload:n.data.data}),t(n.data)}catch(n){o({type:i.Q_,payload:{msg:n.response.statusText,status:n.response.status}}),t({success:!1,message:n.message})}},l=(e,a)=>async t=>{try{const o=await s.Z.delete("".concat(r.Z.instance.baseURL,"/api/provider/").concat(e),{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:i.Z4,payload:e}),a(o.data)}catch(o){t({type:i.Q_,payload:{msg:o.response.statusText,status:o.response.status}}),a({success:!1,message:o.message})}},d=(e,a)=>async t=>{try{const o=await s.Z.get("".concat(r.Z.instance.baseURL,"/api/excel/provider/export?").concat(e,"=").concat(a),{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([o.data])),c=document.createElement("a");c.href=n,c.setAttribute("download","Proveedores.xlsx"),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(n),t({type:i.Nx})}catch(o){t({type:i.Q_,payload:{msg:o.response.statusText,status:o.response.status}})}},u=()=>async e=>{try{const a=await s.Z.get("".concat(r.Z.instance.baseURL,"/api/select/provider"),{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});e({type:i.tb,payload:a.data})}catch(a){e({type:i.Q_,payload:{msg:a.response.statusText,status:a.response.status}})}},p=e=>async a=>{try{const t=await s.Z.get("".concat(r.Z.instance.baseURL,"/api/select/account/provider/").concat(e),{headers:{...r.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});a({type:i.e4,payload:t.data})}catch(t){a({type:i.Q_,payload:{msg:t.response.statusText,status:t.response.status}})}}},7201:(e,a,t)=>{t.d(a,{Jw:()=>d,Tg:()=>m,a4:()=>u,aL:()=>l,iT:()=>o,mY:()=>n,mk:()=>h,uD:()=>p,uf:()=>r,y3:()=>c});var s=t(9779),i=t(9101);const r=e=>(e/1).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),o=e=>s.ou.fromISO(e).toLocaleString(s.ou.DATE_SHORT),n=e=>s.ou.fromISO(e).toLocaleString(s.ou.DATETIME_SHORT),c=e=>new Promise(((a,t)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=e=>a(e.target.result.toString()),s.onerror=t})),l=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{inprogress:a?"Cotizaci\xf3nes enviadas":"Cotizaci\xf3nes disponibles",approved:"Cotizaci\xf3n aprobada",authorized:"Cotizaci\xf3n autorizada",ok:"Cotizaci\xf3n VoBo",sent:a?"Solicitud nueva":"Solicitud enviada",sentPay:"Enviada a pago",paid:"Pagado",rejected:"Cotizaci\xf3nes rechazadas"}[e]},d={inprogress:"#00FFFF",approved:"#00FF00",authorized:"#0000FF",ok:"#008000",sent:"#FFA500",sentPay:"#30AFD4",paid:"#800080",rejected:"#FF0000"},u={pending:"Pendiente de aprobaci\xf3n",approved:"Solicitud aprobada",paid:"Pagado",rejected:"Solicitud rechazada"},p={pending:"#FFA500",approved:"#00FF00",paid:"#800080",rejected:"#FF0000"},h={index:"Listar",show:"Ver",create:"Crear",edit:"Editar",delete:"Eliminar",reject:"Rechazar",pay:"Pagar",approve:"Aprobar",authorize:"Autorizar","authorize.minor.1000":"Autorizar < $1,000","authorize.mayor.1000":"Autorizar > $1,000","authorize.minor.5000":"Autorizar < $5,000","authorize.mayor.5000":"Autorizar > $5,000",modules:"Asignar modulos",permissions:"Asignar permisos","upload.quote":"Subir cotizaci\xf3nes"},m=(e,a)=>{const t=(0,i.v9)((e=>e.auth.permissions)),s=(0,i.v9)((e=>e.auth.modules)).find((a=>a.submodule===e));return!!s&&!!t.find((e=>e.submodule===s.submodule&&e.permission===a))}},1732:(e,a,t)=>{t.d(a,{K:()=>s});const s={provider:"provider",purchaseRequest:"purchaseRequest",quote:"quote",user:"user"}},2731:(e,a,t)=>{t.r(a),t.d(a,{default:()=>Z});var s=t(2791),i=t(2937),r=t(4846),o=t(8030),n=t(8723),c=t(3896),l=t(9101),d=t(1830),u=t.n(d),p=t(7462),h=t(9463),m=t(1732),v=t(7941),x=t(7201),g=t(1232),j=t(5294),y=t(591),b=t(6647);const f=(e,a,t)=>async s=>{try{const i=await j.Z.get("".concat(b.Z.instance.baseURL,"/api/purchaseRequest?").concat(a,"=").concat(t,"&page=").concat(e),{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.Cj,payload:{...i.data,filters:{filter:a,value:t}}})}catch(i){s({type:y.MH,payload:{msg:i.response.statusText,status:i.response.status}})}};var S=t(4166),N=["512 512","<rect width='368' height='32' x='72' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],C=t(184);const R=e=>{let{onAddDetailPending:a,onRemoveDetailPending:t,detailPendingID:n}=e;const{pendingPayments:c}=(0,l.v9)((e=>e.purchaseRequest)),[d,u]=(0,s.useState)([]);return(0,s.useEffect)((()=>{u(c)}),[c]),(0,C.jsxs)(i.Sx,{striped:!0,responsive:!0,children:[(0,C.jsx)(i.V,{children:(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.is,{scope:"col",children:"Opciones"}),(0,C.jsx)(i.is,{scope:"col",children:"Cargo"}),(0,C.jsx)(i.is,{scope:"col",children:"Concepto"}),(0,C.jsx)(i.is,{scope:"col",children:"Obs."}),(0,C.jsx)(i.is,{scope:"col",children:"Saldo pendiente"})]})}),(0,C.jsx)(i.NR,{children:d.map(((e,s)=>(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.NN,{children:n!==e.id?(0,C.jsx)(i.u5,{color:"primary",variant:"outline",title:"Agregar",onClick:()=>a(e),children:(0,C.jsx)(r.Z,{icon:o.q,size:"sm"})}):(0,C.jsx)(i.u5,{color:"danger",variant:"outline",title:"Quitar",onClick:()=>t(),children:(0,C.jsx)(r.Z,{icon:N,size:"sm"})})}),(0,C.jsx)(i.NN,{children:e.quote.quote_concept.charge}),(0,C.jsx)(i.NN,{children:e.quote.quote_concept.concept}),(0,C.jsx)(i.NN,{children:e.title}),(0,C.jsxs)(i.NN,{children:["$",(0,x.uf)(e.balance)]})]},e.id)))})]})},w=e=>{var a,t,r;let{visible:o,onClose:n,purchaseData:c,view:d}=e;const[N,w]=(0,s.useState)(1),[k,A]=(0,s.useState)(""),[Z,z]=(0,s.useState)(null),[T,q]=(0,s.useState)(""),[L,_]=(0,s.useState)(0),[F,I]=(0,s.useState)(0),[E,P]=(0,s.useState)([]),[B,O]=(0,s.useState)(null),[M,D]=(0,s.useState)(null),[U,Q]=(0,s.useState)(!1),[H,K]=(0,s.useState)(!1),[$,V]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(""),[G,W]=(0,s.useState)(""),[J,ee]=(0,s.useState)(""),[ae,te]=(0,s.useState)(""),se=(0,l.I0)(),{progress:ie}=(0,l.v9)((e=>e.file)),re=(0,x.Tg)("purchaseRequest","pay"),oe=(0,x.Tg)("purchaseRequest","reject"),ne=(0,x.Tg)("purchaseRequest","authorize"),ce=null===(a=(0,l.v9)((e=>e.auth.user)))||void 0===a||null===(t=a.data)||void 0===t?void 0:t.user,le=(0,s.useRef)(),de=(0,s.useRef)(),ue=(0,l.v9)((e=>e.provider.providers)),pe=(0,l.v9)((e=>e.provider.accounts)),{purchaseRequests:he,filters:me,pendingPayments:ve}=(0,l.v9)((e=>e.purchaseRequest));(0,s.useEffect)((()=>{se((0,g.Fr)())}),[se]),(0,s.useEffect)((()=>{J&&se((0,g.j7)(J))}),[se,J]),(0,s.useEffect)((()=>{var e;se((e=ce.id,async a=>{try{const t=await j.Z.get("".concat(b.Z.instance.baseURL,"/api/pending/details/purchaseRequest?user_id=").concat(e),{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});a({type:y.eu,payload:t.data})}catch(t){a({type:y.MH,payload:{msg:t.response.statusText,status:t.response.status}})}}))}),[se,ce]),(0,s.useEffect)((()=>{var e,a,t,s;c&&(A(c.id),W(null===c||void 0===c||null===(e=c.quote)||void 0===e?void 0:e.id),P(null===(a=c.files)||void 0===a?void 0:a.filter((e=>e.tag===p.O.img))),O(null===(t=c.files)||void 0===t?void 0:t.find((e=>e.tag===p.O.invoice))),D(null===(s=c.files)||void 0===s?void 0:s.find((e=>e.tag===p.O.receipt))),q(c.title),_(c.totalAmount),I(c.paymentAmount),Q(!!c.totalPaymentApproved),K(!!c.totalPaymentModified),ee(c.provider_id),te(c.provider_account_id),V(c.paymentWithoutInvoice),Y(c.paymentDate),z(c.purchase_request_pending_id))}),[c]);const xe=(0,s.useCallback)((()=>{A(""),W(""),q(""),_(""),I(""),P([])}),[]),ge=e=>{E.length>0?Promise.all(E.map((a=>{if(!a.id)return se((0,h.cT)(a.file,a.tag,null,e.id,m.K.purchaseRequest,(()=>{})));n(),xe()}))).finally((()=>{se(f(he.current_page,me.filter,me.value))})):(n(),xe())},je=e=>{try{se((0,h.cT)(M.file,M.tag,null,e.id,m.K.purchaseRequest,(()=>{se(f(he.current_page,me.filter,me.value))})))}catch(a){console.log(a)}};return(0,s.useEffect)((()=>{100===ie&&setTimeout((()=>{n(),xe()}),3e3)}),[ie,n,xe]),(0,s.useEffect)((()=>{U&&(K(!1),I(L))}),[U,L]),(0,s.useEffect)((()=>{H&&Q(!1)}),[H]),(0,C.jsxs)(i.Tk,{visible:o,onClose:n,"aria-labelledby":"ModalForm",size:"xl",children:[(0,C.jsx)(i.p0,{onClose:n,children:(0,C.jsx)(i.fl,{id:"ModalForm",children:c?"".concat(d?"":"Editar"," Solicitud ").concat(c.title):"Nueva Solicitud"})}),(0,C.jsxs)(i.sD,{children:[E.length>0&&E.some((e=>!e.id))&&(0,C.jsxs)(i.yI,{value:ie,className:"mb-2",children:[ie,"%"]}),M&&!M.id&&(0,C.jsxs)(i.yI,{value:ie,className:"mb-2",children:[ie,"%"]}),(0,C.jsxs)(i.n2,{variant:"tabs",role:"tablist",className:"mt-1",children:[(0,C.jsx)(i.U6,{role:"presentation",children:(0,C.jsx)(i.AQ,{active:1===N,component:"button",role:"tab","aria-controls":"data-tab-pane","aria-selected":1===N,onClick:()=>w(1),children:"General"})}),!ne&&!d&&!(null!==c&&void 0!==c&&c.fromQuote)&&(0,C.jsx)(i.U6,{role:"presentation",children:(0,C.jsx)(i.AQ,{active:2===N,component:"button",role:"tab","aria-controls":"account-tab-pane","aria-selected":2===N,onClick:()=>w(2),children:"Pagos pendientes"})}),(d&&"approved"===c.status&&re||d&&"paid"===c.status)&&(0,C.jsx)(i.U6,{role:"presentation",children:(0,C.jsx)(i.AQ,{active:3===N,component:"button",role:"tab","aria-controls":"account-tab-pane","aria-selected":3===N,onClick:()=>w(3),children:"Tramite de pago"})})]}),(0,C.jsxs)(i.gr,{children:[(0,C.jsx)(i.IA,{role:"tabpanel","aria-labelledby":"data-tab-pane",visible:1===N,children:(0,C.jsxs)(i.lx,{className:"mt-3",children:[c&&c.fromQuote&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"mb-3 d-flex",children:[(0,C.jsxs)("div",{className:"flex-md-fill me-2",children:[(0,C.jsx)(i.L8,{children:"Proveedor"}),(0,C.jsxs)(i.LX,{"aria-label":"provider",onChange:e=>ee(e.target.value),value:J,disabled:d||(null===c||void 0===c?void 0:c.fromQuote),children:[(0,C.jsx)("option",{value:"",children:"Selecciona..."}),ue.data.map((e=>{let{id:a,name:t}=e;return(0,C.jsx)("option",{value:a,children:t},a)}))]})]}),(0,C.jsxs)("div",{className:"flex-md-fill me-2",children:[(0,C.jsx)(i.L8,{children:"Cuenta"}),(0,C.jsxs)(i.LX,{"aria-label":"providerAccount",onChange:e=>te(e.target.value),value:ae,disabled:d,children:[(0,C.jsx)("option",{value:"",children:"Selecciona..."}),null===pe||void 0===pe||null===(r=pe.data)||void 0===r?void 0:r.map((e=>{let{id:a,clabe:t,bank:s}=e;return(0,C.jsxs)("option",{value:a,children:[s.name," - ",t]},a)}))]})]})]}),B&&(0,C.jsx)("div",{className:"mb-3 d-flex",children:(0,C.jsx)(v.sZ,{file:B,onDelete:e=>{O(null)},viewMode:c})}),(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsx)(i.EC,{id:"paymentWithoutInvoice",label:"Tramitar pago sin factura",checked:$,onChange:e=>V(e.target.checked),disabled:d||(null===c||void 0===c?void 0:c.fromQuote)})})]}),(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsx)(i.L8,{children:"T\xedtulo"}),(0,C.jsx)(i.jO,{type:"text",id:"title",placeholder:"T\xedtulo de la solicitud",value:T,onChange:e=>q(e.target.value),disabled:d})]}),(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsx)(i.L8,{children:"Monto"}),(0,C.jsx)(i.jO,{type:"number",id:"totalAmount",placeholder:"0",value:L,onChange:e=>_(e.target.value),disabled:d||(null===c||void 0===c?void 0:c.fromQuote)||Z})]}),!d&&(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsxs)(i.L8,{children:["Sube ",(0,C.jsx)("b",{children:"im\xe1genes"})," para la solicitud (opcional)"]}),(0,C.jsx)(i.jO,{ref:le,type:"file",id:"imgFile",onChange:e=>{if(!e.target.files[0])return;let a={localName:e.target.files[0].name,tag:p.O.img,file:e.target.files[0]};P([...E,a]),le.current.value=""},accept:"image/*",text:"Archivos permitidos jpg, png, jpeg (10 MB)"})]}),(0,C.jsx)("div",{className:"mb-3 d-flex",children:E.map(((e,a)=>(0,C.jsx)(v.sZ,{file:e,onDelete:t=>e.id?P(E.filter((e=>e.id!==t))):P(E.filter(((e,t)=>a!==t))),viewMode:d},e.tag)))}),(d&&ne||"approved"===(null===c||void 0===c?void 0:c.status)||"paid"===(null===c||void 0===c?void 0:c.status))&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsx)(i.EC,{id:"totalPaymentApproved",label:"Se aprueba monto de pago",checked:U,onChange:e=>Q(e.target.checked),disabled:d&&"approved"===c.status||"paid"===c.status})}),(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsx)(i.EC,{id:"totalPaymentModified",label:"Se modifica monto de pago",checked:H,onChange:e=>K(e.target.checked),disabled:d&&"approved"===c.status||"paid"===c.status})}),H&&(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsx)(i.L8,{children:"Monto"}),(0,C.jsx)(i.jO,{type:"number",id:"amount",placeholder:"0",value:F,onChange:e=>I(e.target.value),disabled:d&&"approved"===c.status||"paid"===c.status})]}),H&&(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsxs)(i.L8,{className:"fw-bold",children:["Saldo $",(0,x.uf)(L-F)]})})]})]})}),(0,C.jsx)(i.IA,{role:"tabpanel","aria-labelledby":"data-tab-pane",visible:2===N,children:ve.length>0?(0,C.jsx)(R,{detailPendingID:Z,onAddDetailPending:e=>{return z((a=e).id),_(a.balance),I(a.balance),q(a.title),w(1),null!==a&&void 0!==a&&a.quote&&W(a.quote.id),ee(a.provider_id),void te(a.provider_account_id);var a},onRemoveDetailPending:()=>{z(null),_(0),I(0),q(""),w(1)}}):(0,C.jsx)("h3",{className:"text-center text-primary font-monospace",children:"No hay pagos pendientes"})}),(0,C.jsx)(i.IA,{role:"tabpanel","aria-labelledby":"data-tab-pane",visible:3===N,children:(0,C.jsxs)(i.lx,{className:"mt-3",children:[(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsx)(i.L8,{children:"Dia de pago"}),(0,C.jsx)(i.jO,{type:"date",id:"paymentDate",value:X,onChange:e=>Y(e.target.value),disabled:d&&"paid"===c.status})]}),d&&"paid"!==c.status&&(0,C.jsxs)("div",{className:"mb-3",children:[(0,C.jsx)(i.L8,{children:"Adjuntar comprobante de pago"}),(0,C.jsx)(i.jO,{type:"file",ref:de,id:"receiptFile",onChange:e=>D({file:e.target.files[0],tag:p.O.receipt,localName:e.target.files[0].name}),text:"Archivos permitidos jpg, pdf, png, xlxs (10 MB)"})]}),(0,C.jsx)("div",{className:"mb-3 d-flex",children:M&&(0,C.jsx)(v.sZ,{file:M,onDelete:e=>{D(null),de.current.value=""},viewMode:d&&"paid"===c.status})})]})})]})]}),(0,C.jsxs)(i.Ym,{children:[(0,C.jsx)(i.u5,{color:"secondary",onClick:n,children:"Cerrar"}),"approved"!==(null===c||void 0===c?void 0:c.status)&&!re&&"paid"!==(null===c||void 0===c?void 0:c.status)&&(0,C.jsx)(i.u5,{color:"primary",className:"text-light fw-semibold",onClick:e=>{e.preventDefault();try{let e={quote_id:G,title:T,paymentAmount:F,totalAmount:L,provider_id:J,provider_account_id:ae,paymentWithoutInvoice:$,totalPaymentApproved:U,totalPaymentModified:H,purchase_request_pending_id:Z};se(c?((e,a,t)=>async s=>{try{const i=await j.Z.put("".concat(b.Z.instance.baseURL,"/api/purchaseRequest/").concat(a),e,{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.kX,payload:i.data.data}),t(i.data)}catch(i){s({type:y.MH,payload:{msg:i.response.statusText,status:i.response.status}}),t({success:!1,message:i.message})}})(e,k,(e=>{e.success?(se((0,S.f)((0,v.Kv)({msg:"Solicitud actualizada correctamente.",title:"Solicitudes de compra",type:"success"}))),ge(e.data)):se((0,S.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de compra",type:"error"})))})):((e,a)=>async t=>{try{const s=await j.Z.post("".concat(b.Z.instance.baseURL,"/api/purchaseRequest"),e,{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:y.LB,payload:s.data.data}),a(s.data)}catch(s){t({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}}),a({success:!1,message:s.message})}})({...e,petitioner_id:ce.id},(e=>{e.success?(se((0,S.f)((0,v.Kv)({msg:"Solicitud realizada correctamente.",title:"Solicitudes de compra",type:"success"}))),ge(e.data)):se((0,S.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de compra",type:"error"})))})))}catch(a){console.log(a)}},children:"Guardar"}),d&&(0,C.jsxs)(C.Fragment,{children:["approved"===c.status&&re&&(0,C.jsx)(i.u5,{color:"info",className:"text-light fw-semibold",onClick:()=>{try{if(!X)return void alert("Selecciona fecha de pago");if(!M)return void alert("Adjunta comprobante de pago");se((e={paymentDate:X,user_id:ce.id},a=c.id,t=e=>{e.success&&(je(e.data),se((0,S.f)((0,v.Kv)({msg:e.message,type:"success"}))),u().fire({title:"Solicitud pagada"}))},async s=>{try{const i=await j.Z.put("".concat(b.Z.instance.baseURL,"/api/pay/purchaseRequest/").concat(a),e,{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});s({type:y.kX,payload:i.data.data}),t(i.data)}catch(i){s({type:y.MH,payload:{msg:i.response.statusText,status:i.response.status}}),t({success:!1,message:i.message})}}))}catch(s){u().showValidationMessage("Request failed: ".concat(s))}var e,a,t},children:"Pagar"}),"paid"!==c.status&&oe&&"approved"!==c.status&&!c.fromQuote&&(0,C.jsx)(i.u5,{color:"danger",className:"text-light fw-semibold",onClick:()=>{u().fire({title:"Escribe un motivo del rechazo",input:"textarea",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Enviar",confirmButtonColor:"#E94834",showLoaderOnConfirm:!0,preConfirm:async e=>{try{if(!e)return void u().showValidationMessage("\n            Escribe una observacion\n          ");se((a={observation:e,user_id:ce.id},t=c.id,s=e=>{e.success&&se((0,S.f)((0,v.Kv)({msg:"Solicitud rechazada",type:"success"})))},async e=>{try{const i=await j.Z.put("".concat(b.Z.instance.baseURL,"/api/reject/purchaseRequest/").concat(t),a,{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});e({type:y.kX,payload:i.data.data}),s(i.data)}catch(i){e({type:y.MH,payload:{msg:i.response.statusText,status:i.response.status}}),s({success:!1,message:i.message})}}))}catch(i){u().showValidationMessage("\n            Request failed: ".concat(i,"\n          "))}var a,t,s},allowOutsideClick:()=>!u().isLoading()}).then((e=>{e.isConfirmed&&u().fire({title:"Solicitud rechazada correctamente"})}))},children:"Rechazar"})]})]})]})},k=e=>{var a,t;let{visible:r,onClose:o,purchaseRequestID:n}=e;const c=(0,l.I0)(),[d,u]=(0,s.useState)(""),{observations:p,loadingObservations:h}=(0,l.v9)((e=>e.purchaseRequest)),m=null===(a=(0,l.v9)((e=>e.auth.user)))||void 0===a||null===(t=a.data)||void 0===t?void 0:t.user;(0,s.useEffect)((()=>{var e;c((e=n,async a=>{try{const t=await j.Z.get("".concat(b.Z.instance.baseURL,"/api/purchaseRequestObservation?purchase_request_id=").concat(e),{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});a({type:y.oj,payload:t.data})}catch(t){a({type:y.MH,payload:{msg:t.response.statusText,status:t.response.status}})}}))}),[c,n]);return(0,C.jsxs)(i.Tk,{visible:r,onClose:o,"aria-labelledby":"ModalForm",children:[(0,C.jsx)(i.p0,{onClose:o,children:(0,C.jsx)(i.fl,{id:"ModalForm",children:"Observaciones"})}),(0,C.jsx)(i.sD,{children:h?(0,C.jsx)("div",{className:"d-flex justify-content-center",children:(0,C.jsx)(i.LQ,{color:"primary",variant:"grow"})}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(i.Sx,{striped:!0,responsive:!0,children:[(0,C.jsx)(i.V,{children:(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.is,{scope:"col",children:"Usuario"}),(0,C.jsx)(i.is,{scope:"col",children:"Observaci\xf3n"}),(0,C.jsx)(i.is,{scope:"col",children:"Fecha"})]})}),(0,C.jsx)(i.NR,{children:null===p||void 0===p?void 0:p.map((e=>(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.NN,{children:e.user.name}),(0,C.jsx)(i.NN,{children:e.message}),(0,C.jsx)(i.NN,{children:(0,x.mY)(e.created_at)})]},e.id)))})]}),(0,C.jsx)(i.lx,{className:"mt-3",children:(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsx)(i.PB,{id:"obs",label:"Observaci\xf3n",rows:2,text:"Debe tener entre 8 y 20 palabras.",value:d,onChange:e=>u(e.target.value)})})})]})}),(0,C.jsxs)(i.Ym,{children:[(0,C.jsx)(i.u5,{color:"secondary",onClick:o,children:"Cerrar"}),(0,C.jsx)(i.u5,{color:"primary",className:"text-light fw-semibold",onClick:e=>{e.preventDefault();try{if(!d||""===d)return void c((0,S.f)((0,v.Kv)({msg:"Escribe un mensaje",title:"Error",type:"error"})));let e={message:d,user_id:m.id,purchase_request_id:n};c(((e,a)=>async t=>{try{const s=await j.Z.post("".concat(b.Z.instance.baseURL,"/api/purchaseRequestObservation"),e,{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:y.L4,payload:s.data.data}),a(s.data)}catch(s){t({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}}),a({success:!1,message:s.message})}})(e,(e=>{e.success?c((0,S.f)((0,v.Kv)({msg:"Mensaje guardado con exito",title:"Observacion",type:"success"}))):c((0,S.f)((0,v.Kv)({msg:"Ha ocurrido un error",title:"Observacion",type:"error"})))})))}catch(a){console.log(a)}u("")},children:"Guardar"})]})]})},A=e=>{let{data:a}=e;const[t,o]=(0,s.useState)(!1),[n,d]=(0,s.useState)(!1),[p,g]=(0,s.useState)(null),[f,N]=(0,s.useState)(!1),R=(0,l.I0)(),A=(0,x.Tg)("purchaseRequest","delete"),Z=(0,x.Tg)("purchaseRequest","edit"),z=(0,x.Tg)("purchaseRequest","show"),T=e=>{u().fire({title:"\xbfEst\xe1 seguro?",text:"No podr\xe1s revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar."}).then((a=>{a.isConfirmed&&(R(((e,a)=>async t=>{try{const s=await j.Z.delete("".concat(b.Z.instance.baseURL,"/api/purchaseRequest/").concat(e),{headers:{...b.Z.instance.headers,Authorization:"Bearer "+localStorage.getItem("token")}});t({type:y.jx,payload:e}),a(s.data)}catch(s){t({type:y.MH,payload:{msg:s.response.statusText,status:s.response.status}}),a({success:!1,message:s.message})}})(e,(a=>{a.success?(R((0,S.f)((0,v.Kv)({msg:"Solicitud eliminada correctamente.",title:"Solicitudes de pago",type:"success"}))),R((0,h.MM)(e,m.K.purchaseRequest))):R((0,S.f)((0,v.Kv)({msg:"Ha ocurrido un error.",title:"Solicitudes de pago",type:"error"})))}))),u().fire({title:"Eliminado!",text:"La solicitud ha sido eliminada.",icon:"success"}))}))};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(i.Sx,{striped:!0,responsive:!0,children:[(0,C.jsx)(i.V,{children:(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.is,{scope:"col",children:"Folio"}),(0,C.jsx)(i.is,{scope:"col",children:"Solicitante"}),(0,C.jsx)(i.is,{scope:"col",children:"Titulo"}),(0,C.jsx)(i.is,{scope:"col",children:"Fecha de solicitud"}),(0,C.jsx)(i.is,{scope:"col",children:"Monto"}),(0,C.jsx)(i.is,{scope:"col",children:"Status"}),(0,C.jsx)(i.is,{scope:"col",className:"text-center",children:"Opciones"})]})}),(0,C.jsx)(i.NR,{children:null===a||void 0===a?void 0:a.map((e=>(0,C.jsxs)(i.T6,{children:[(0,C.jsx)(i.is,{scope:"row",children:e.id}),(0,C.jsx)(i.NN,{children:e.petitioner.name}),(0,C.jsx)(i.NN,{children:e.title}),(0,C.jsx)(i.NN,{children:(0,x.iT)(e.created_at)}),(0,C.jsxs)(i.NN,{children:["$",(0,x.uf)(e.paymentAmount)]}),(0,C.jsx)(i.NN,{children:(0,C.jsx)(i.C_,{style:{backgroundColor:x.uD[e.status]},children:x.a4[e.status]})}),(0,C.jsx)(i.NN,{className:"text-center overflow-visible",children:(0,C.jsxs)(i.w5,{variant:"dropdown",children:[(0,C.jsx)(i.SQ,{href:"#",color:"light",children:(0,C.jsx)(r.Z,{icon:c.t,title:"Opciones",size:"lg"})}),(0,C.jsxs)(i.$H,{className:"position-fixed",children:[z&&(0,C.jsx)(i.$f,{style:{cursor:"pointer"},onClick:()=>{g(e),N(!0),o(!t)},children:"Ver solicitud"}),Z&&"approved"!==e.status&&"paid"!==e.status&&(0,C.jsx)(i.$f,{style:{cursor:"pointer"},onClick:()=>{g(e),o(!t)},children:"Editar"}),A&&"approved"!==e.status&&"paid"!==e.status&&!e.fromQuote&&(0,C.jsx)(i.$f,{style:{cursor:"pointer"},onClick:()=>T(e.id),children:"Eliminar"}),(0,C.jsx)(i.$f,{style:{cursor:"pointer"},onClick:()=>{g(e),d(!n)},children:"Ver observaciones"})]})]})})]},e.id)))})]}),t&&(0,C.jsx)(w,{visible:t,onClose:()=>{o(!1),N(!1)},purchaseData:p,view:f}),n&&(0,C.jsx)(k,{purchaseRequestID:null===p||void 0===p?void 0:p.id,visible:n,onClose:()=>d(!1)})]})},Z=()=>{const[e,a]=(0,s.useState)(!1),[t,c]=(0,s.useState)("provider"),[d,u]=(0,s.useState)(""),[p,h]=(0,s.useState)(1),m=(0,l.I0)(),{currentPage:g,last_page:j,data:y}=(0,l.v9)((e=>e.purchaseRequest.purchaseRequests)),b=(0,l.v9)((e=>e.purchaseRequest.loading));return(0,s.useEffect)((()=>{m(f(p,t,d))}),[p,m]),(0,s.useEffect)((()=>{g&&h(g)}),[g]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(i.xH,{children:[(0,C.jsxs)(i.bn,{className:"d-flex justify-content-between align-items-center",children:[(0,C.jsx)("h4",{children:"Solicitudes de pago"}),(0,C.jsxs)("div",{className:"d-flex gap-2",children:[(0,x.Tg)("purchaseRequest","create")&&(0,C.jsxs)(i.u5,{color:"primary",className:"text-light fw-semibold align-content-center d-flex",onClick:()=>a(!e),children:[(0,C.jsx)(r.Z,{icon:o.q,size:"xl",className:"me-1"}),"Nuevo"]}),(0,C.jsx)(i.u5,{color:"info",className:"text-light align-content-center d-flex",children:(0,C.jsx)(r.Z,{icon:n.j,size:"xl"})})]})]}),(0,C.jsxs)(i.sl,{children:[(0,C.jsxs)(i.lx,{children:[(0,C.jsx)(i.L8,{children:"Filtros de busqueda"}),(0,C.jsxs)("div",{className:"mb-3 d-flex",children:[(0,C.jsx)("div",{className:"flex-fill me-2",children:(0,C.jsx)(i.LX,{value:t,onChange:e=>c(e.target.value),"aria-label":"caseFilter",options:[{label:"Proveedor",value:"provider"},{label:"Solicitante",value:"petitioner"},{label:"Status",value:"status"}]})}),(0,C.jsx)("div",{className:"flex-fill me-2",children:"status"!==t?(0,C.jsx)(i.jO,{value:d,onChange:e=>u(e.target.value),type:"text",id:"provider",placeholder:"Ingresar texto"}):(0,C.jsx)(i.LX,{value:d,onChange:e=>u(e.target.value),"aria-label":"caseFilter",options:[{label:"Pendientes",value:"pending"},{label:"Revisadas",value:"review"},{label:"Aprobadas",value:"approved"},{label:"Rechazadas",value:"rejects"}]})})]}),(0,C.jsx)(i.u5,{type:"button",className:"text-light fw-semibold",onClick:()=>m(f(p,t,d)),children:"Buscar"})]}),b?(0,C.jsx)("div",{className:"d-flex justify-content-center",children:(0,C.jsx)(i.LQ,{color:"primary",variant:"grow"})}):(0,C.jsx)(A,{data:y})]}),(0,C.jsx)(i.Bt,{children:(0,C.jsx)(v.bD,{currentPage:p,lastPage:j,setCurrentPage:h})})]}),(0,C.jsx)(w,{visible:e,onClose:()=>a(!1)})]})}}}]);
//# sourceMappingURL=731.5e2a8faa.chunk.js.map